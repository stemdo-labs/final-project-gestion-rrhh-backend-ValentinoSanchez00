pipeline {
    agent any
    triggers {
        pollSCM('') 
    }
    environment {
        MICROSERVICE = 'backend' // Puedes ajustar este valor según sea necesario
        ENVIRONMENT = '' 
    }
    stages {
        stage('Determine Environment') {
            steps {
                script {
                    // Detecta la rama y asigna el valor adecuado a ENVIRONMENT
                    if (env.BRANCH_NAME == 'main' || env.BRANCH_NAME.startsWith('pr')) {
                        ENVIRONMENT = 'production'
                    } else if (env.BRANCH_NAME == 'develop') {
                        ENVIRONMENT = 'develop'
                    } else {
                        error "Push desde rama no soportada: ${env.BRANCH_NAME}. No se realizará ninguna acción."
                    }
                }
            }
        }
        stage('Trigger SubirDFB-Vsanchez') {
            when {
                expression { ENVIRONMENT != '' } 
            }
            steps {
                script {
                    build job: 'SubirDFB-Vsanchez', 
                    parameters: [
                        string(name: 'MICROSERVICE', value: MICROSERVICE),
                        string(name: 'ENVIRONMENT', value: ENVIRONMENT)
                    ]
                }
            }
        }
    }
}
